{% extends "base.html" %}

{% load i18n %}
{% load static from staticfiles %}

{% block meta_title %}{% trans "Students" %}{% endblock meta_title %}

{% block titile %}{% trans "Students List" %}{% endblock titile %}

{% block content %}
<a class="btn btn-primary" href="{% url "students_add" %}">{% trans "Add Student" %}</a>

  <!-- Start Students Listing -->
  {% if students %}
  <table class="table table-striped">
    {% with order_by=request.GET.order_by reverse=request.GET.reverse %}
        <thead>
            <tr>
                <th> <a href="{% url "home" %}?order_by=id{% if request.GET.order_by == 'id' and request.GET.reverse != '1' %}&amp;reverse=1{% endif %}">
                        №
                        {% if request.GET.order_by == 'id' and request.GET.reverse != '1' %}
                            &darr;
                        {% elif request.GET.order_by == 'id' and request.GET.reverse == '1' %}
                            &uarr;
                        {% endif %}
                </th>
                <th>{% trans "Photo" %}</th>
                <th>
                    <a href="{% url "home" %}?order_by=last_name{% if order_by == 'last_name' and reverse != '1' %}&amp;reverse=1{% endif %}">
                    {% trans "Last Name" %}
                    {% if order_by == 'last_name' and reverse != '1' %}&uarr;
                    {% elif order_by == 'last_name' and reverse == '1' %}&darr;
                    {% endif %}</a>
                </th>
                <th>
                    <a href="{% url "home" %}?order_by=first_name{% if order_by == 'first_name' and reverse != '1' %}&amp;reverse=1{% endif %}">
                    {% trans "First Name" %}
                    {% if order_by == 'first_name' and reverse != '1' %}&uarr;{% elif order_by == 'first_name' and reverse == '1' %}&darr;
                    {% endif %}
                </th>
                <th>
                    <a href="{% url "home" %}?order_by=ticket{% if order_by == 'ticket' and reverse != '1' %}&amp;reverse=1{% endif %}">
                    {% trans "№ Ticket" %}
                    {% if order_by == 'ticket' and reverse != '1' %}&uarr;
                    {% elif order_by == 'ticket' and reverse == '1' %}&darr;
                    {% endif %}
                    </a>
                </th>
            <th>{% trans "Actions" %}</th>
            </tr>
        </thead>
    {% endwith %}
    <tbody>
    {% for student in students %}
      <tr>
        <td>{% if is_paginated %}
          {{ page_obj.start_index|add:forloop.counter0 }}
        {% else %}
          {{ forloop.counter }}
        {% endif %}
        <td>
             {% if student.photo %}
                <img class="img-circle" src="{{ student.photo.url }}" height="30" width="30" />
            {% else %}
          <img class="img-circle" src="{% static "img/default.png" %}"
               height="30" width="30" />
        {% endif %}
        </td>
        <td><a href="{% url "students_edit" student.id %}" class="student-edit-form-link">{{ student.last_name }}</a></td>
        <td><a href="{% url "students_edit" student.id %}" class="student-edit-form-link">{{ student.first_name }}</a></td>
        <td>{{ student.ticket }}</td>
        <td>
          <div class="btn-group">
            <button type="button" class="btn btn-default dropdown-toggle"
              data-toggle="dropdown">
                Дія <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" role="menu">
              <li><a href="{% url "students_edit" student.id %}" class="student-edit-form-link">{% trans "Edit" %}</a></li>
              <li><a href="{% url "journal" student.id %}">{% trans "Journal" %}</a></li>
              <li><a href="{% url "students_delete" student.id %}">{% trans "Delete" %}</a></li>
            </ul>
          </div>
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
  <!-- End Students Listing -->
  {% else %}
  <p>Поки немає студентів у базі</p>
  {% endif %}

  <!-- Start nav -->
    {% if students.has_other_pages %}
    {% with order_by=request.GET.order_by reverse=request.GET.reverse %}
    <nav>
      <ul class="pagination">
        <li><a href="{% url 'home' %}?page=1&amp;order_by={{ order_by }}&amp;reverse={{ reverse }}">&laquo;</a></li>
        {% for p in students.paginator.page_range %}
        <li {% if students.number == p %}class="active"{% endif %}><a href="{% url "home" %}?page={{ p }}&amp;order_by={{ order_by }}&amp;reverse={{ reverse }}">{{ p }}</a></li>
        {% endfor %}
        <li><a href="{% url "home" %}?page={{ students.paginator.num_pages }}&amp;order_by={{ order_by }}&amp;reverse={{ reverse }}">&raquo;</a></li>
      </ul>
    </nav>
    {% endwith %}
    {% endif %}
  <!-- End nav -->
{% endblock content %}



<ul class="pagination">

{% if page_obj.has_previous %}
    <li><a href="?page={{ page_obj.previous_page_number }}"><i class="fa fa-chevron-left" aria-hidden="true"></i></a></li>
{% else %}
    <li class="disabled"><span><i class="fa fa-chevron-left" aria-hidden="true"></i></span></li>
{% endif %}

{% if page_obj.number|add:'-4' > 1 %}
    <li><a href="?page={{ page_obj.number|add:'-5' }}">&hellip;</a></li>
{% endif %}

{% for i in page_obj.paginator.page_range %}
    {% if page_obj.number == i %}
        <li class="active"><span>{{ i }} <span class="sr-only">(current)</span></span></li>
    {% elif i > page_obj.number|add:'-5' and i < page_obj.number|add:'5' %}
        <li><a href="?page={{ i }}">{{ i }}</a></li>
    {% endif %}
{% endfor %}

{% if page_obj.paginator.num_pages > page_obj.number|add:'4' %}
    <li><a href="?page={{ page_obj.number|add:'5' }}">&hellip;</a></li>
{% endif %}

{% if page_obj.has_next %}
    <li><a href="?page={{ page_obj.next_page_number }}"><i class="fa fa-chevron-right" aria-hidden="true"></i></a></li>
{% else %}
    <li class="disabled"><span><i class="fa fa-chevron-right" aria-hidden="true"></i></span></li>
{% endif %}

</ul>